!function(){"use strict";var e=window.wp.blocks,t=window.wp.element,a=window.wp.components,l=window.wp.data,o=window.wp.blockEditor,s=window.wp.compose;function n(){return n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},n.apply(this,arguments)}const r="wsu-gutenberg-people-directory-multi-text-control";var i=e=>{let{label:l,values:o,onChange:s,isFallbackData:i,placeholder:c,insertText:_}=e;const m=i?"placeholder":"value";function d(e,t){const a=[...o];a[e]=t,s(a)}return o=0===o.length?[""]:o,(0,t.createElement)(t.Fragment,null,(0,t.createElement)("label",{class:"components-base-control__label"},l),o.length?o.map(((e,l)=>{const i={};return i[m]=e,""===e&&(i.placeholder=c),(0,t.createElement)("div",{className:`${r}__value`},(0,t.createElement)(a.TextControl,n({key:l,onChange:e=>d(l,e)},i)),o.length>1&&(0,t.createElement)(a.Button,{isDestructive:!0,isSmall:!0,className:`${r}__remove-btn`,icon:"no-alt",onClick:()=>function(e){s(o.filter(((t,a)=>a!==e)))}(l)}))})):(0,t.createElement)(a.TextControl,{placeholder:c,onChange:e=>d(0,e)}),(0,t.createElement)(a.Button,{className:`${r}__insert-btn`,text:_,variant:"secondary",onClick:function(){s([...o,""])}}))};const c="wsu-gutenberg-people-directory-profile",_=(e,a)=>{const l=(0,t.useRef)(!1);(0,t.useEffect)((()=>{if(l.current){const t=e();return()=>t&&t()}l.current=!0}),a),(0,t.useEffect)((()=>()=>l.current=!1),[])},{InnerBlocks:m}=wp.blockEditor;(0,e.registerBlockType)("wsuwp/people-directory-profile",{title:"Profile",icon:"admin-users",category:"text",attributes:{hasCustomBio:{type:"boolean",default:!1}},edit:function(e){let{className:n,clientId:r,attributes:m,setAttributes:d,...p}=e;const{editPost:u}=(0,l.useDispatch)("core/editor"),[w,h]=(0,t.useState)(!1),{defaultPostTitle:f,defaultPostMeta:b}=(0,l.useSelect)((e=>{const t=e("core/editor");return{defaultPostTitle:t.getEditedPostAttribute("title"),defaultPostMeta:t.getEditedPostAttribute("meta")}})),{photoPreview:E,hasResolvedPhoto:g,isCustomPhoto:v}=(0,l.useSelect)((e=>{if(!b.wsuwp_photo)return{photoPreview:b._wsuwp_fallback_photo,hasResolvedPhoto:!0,isCustomPhoto:!1};const t=e("core").getMedia(b.wsuwp_photo);return e("core/data").hasFinishedResolution("core","getMedia",[b.wsuwp_photo])?{photoPreview:t?t.source_url:b._wsuwp_fallback_photo,hasResolvedPhoto:!0,isCustomPhoto:!!t}:{photoPreview:"",hasResolvedPhoto:!1,isCustomPhoto:!1}}),[b]),[C,N]=(0,t.useState)(f),[$,k]=(0,t.useState)({first_name:b.wsuwp_first_name,middle_name:b.wsuwp_middle_name,last_name:b.wsuwp_last_name,display_name:b.wsuwp_display_name,title:b.wsuwp_title,office:b.wsuwp_office,address:b.wsuwp_address,phone:b.wsuwp_phone,email:b.wsuwp_email,degree:b.wsuwp_degree,website:b.wsuwp_website,photo:b.wsuwp_photo}),y=(0,s.useCopyToClipboard)(b._wsuwp_nid,(function(e){h((()=>!0))}));function x(e,t){k((a=>({...a,[e]:t})))}return(0,t.useEffect)((()=>{const e=setTimeout((()=>{h((()=>!1))}),3e3);return()=>clearTimeout(e)}),[w]),_((()=>{u({meta:{wsuwp_first_name:$.first_name,wsuwp_middle_name:$.middle_name,wsuwp_last_name:$.last_name,wsuwp_display_name:$.display_name,wsuwp_title:$.title,wsuwp_office:$.office,wsuwp_address:$.address,wsuwp_phone:$.phone,wsuwp_email:$.email,wsuwp_degree:$.degree,wsuwp_website:$.website,wsuwp_photo:$.photo}})}),[$]),_((()=>{const e=$.first_name||b._wsuwp_fallback_first_name,t=$.middle_name||b._wsuwp_fallback_middle_name,a=`${$.last_name||b._wsuwp_fallback_last_name}, ${e} ${t}`.trim();N(a),u({title:a})}),[$.first_name,$.middle_name,$.last_name]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:c},(0,t.createElement)("div",{className:`${c}__header`},C&&(0,t.createElement)("h1",{className:`${c}__post-title`},C),b._wsuwp_nid&&(0,t.createElement)("div",{className:`${c}__nid`},w&&(0,t.createElement)(a.Popover,{className:`${c}__nid-copy-notice`,placement:"top-end"},"Copied!"),(0,t.createElement)(a.TextControl,{className:`${c}__nid-input`,value:b._wsuwp_nid,disabled:!0}),(0,t.createElement)(a.Button,{ref:y,className:`${c}__nid-copy-btn`,label:"Copy",icon:"admin-page"}))),(0,t.createElement)("div",{className:`${c}__editor`},(0,t.createElement)("div",{className:`${c}__editor-left-column`},(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)("div",{className:`${c}__photo-field`},g&&E&&(0,t.createElement)("img",{className:`${c}__photo`,src:E})),(0,t.createElement)(o.MediaUploadCheck,null,(0,t.createElement)(o.MediaUpload,{onSelect:e=>x("photo",e.id),allowedTypes:["image"],multiple:!1,gallery:!1,value:$.photo,render:e=>{let{open:l}=e;return(0,t.createElement)(a.BaseControl,null,(0,t.createElement)(a.Button,{isPrimary:!0,onClick:l,className:`${c}__photo-upload-btn`},E?"Change Photo":"Select Photo"),v?(0,t.createElement)(a.Button,{isDestructive:!0,onClick:()=>x("photo",0),className:`${c}__photo-remove-btn`,text:"Remove Photo"}):null)}})))),(0,t.createElement)("div",{className:`${c}__editor-right-column`},(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"First Name",className:`${c}__text-control`,placeholder:b._wsuwp_fallback_first_name,onChange:e=>x("first_name",e),value:$.first_name})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Middle Name",className:`${c}__text-control`,placeholder:b._wsuwp_fallback_middle_name,onChange:e=>x("middle_name",e),value:$.middle_name})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Last Name",className:`${c}__text-control`,placeholder:b._wsuwp_fallback_last_name,onChange:e=>x("last_name",e),value:$.last_name})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Display Name",className:`${c}__text-control`,placeholder:b._wsuwp_fallback_display_name,onChange:e=>x("display_name",e),value:$.display_name})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(i,{label:"Title(s)",onChange:e=>x("title",e),insertText:"Add another title",isFallbackData:0===$.title.length,placeholder:"Enter job title",values:$.title.length?$.title:b._wsuwp_fallback_title})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Phone Number",className:`${c}__text-control`,placeholder:b._wsuwp_fallback_phone,onChange:e=>x("phone",e),value:$.phone})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Email",className:`${c}__text-control`,placeholder:b._wsuwp_fallback_email,onChange:e=>x("email",e),value:$.email})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Office",className:`${c}__text-control`,placeholder:b._wsuwp_fallback_office,onChange:e=>x("office",e),value:$.office})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Address",className:`${c}__text-control`,placeholder:b._wsuwp_fallback_address,onChange:e=>x("address",e),value:$.address})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Website",className:`${c}__text-control`,placeholder:b._wsuwp_fallback_website||"Enter website URL",onChange:e=>x("website",e),value:$.website})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(i,{label:"Degree(s)",onChange:e=>x("degree",e),insertText:"Add another degree",isFallbackData:0===$.degree.length,placeholder:"Enter degree",values:$.degree.length?$.degree:b._wsuwp_fallback_degree})))),(0,t.createElement)("div",{className:`${c}__bio-container`},(0,t.createElement)("div",{className:`${c}__bio-header`},(0,t.createElement)("h2",null,"Biography"),(0,t.createElement)(a.ToggleControl,{label:"Use custom bio",className:`${c}__bio-type-toggle`,checked:m.hasCustomBio,onChange:()=>d({hasCustomBio:!m.hasCustomBio})})),m.hasCustomBio?(0,t.createElement)(o.InnerBlocks,{template:[["core/paragraph",{placeholder:"Enter biography content."}]],allowedBlocks:["core/paragraph","core/heading","core/list","core/quote","wsuwp/button","core/separator","wsuwp/row","core/image","core/gallery"],templateLock:!1}):""===b._wsuwp_fallback_bio.trim()?(0,t.createElement)("p",null,(0,t.createElement)("i",null,"No content to display.")):(0,t.createElement)("div",{dangerouslySetInnerHTML:{__html:b._wsuwp_fallback_bio}}))))},save:e=>(0,t.createElement)(m.Content,null)})}();