!function(){"use strict";var e=window.wp.blocks,t=window.wp.element,a=window.wp.components,l=window.wp.data,o=window.wp.blockEditor;function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var l in a)Object.prototype.hasOwnProperty.call(a,l)&&(e[l]=a[l])}return e},s.apply(this,arguments)}const n="wsu-gutenberg-people-directory-multi-text-control";var r=e=>{let{label:l,values:o,onChange:r,isFallbackData:c,placeholder:i,insertText:_}=e;const m=c?"placeholder":"value";function d(e,t){const a=[...o];a[e]=t,r(a)}return o=0===o.length?[""]:o,(0,t.createElement)(t.Fragment,null,(0,t.createElement)("label",{class:"components-base-control__label"},l),o.length?o.map(((e,l)=>{const c={};return c[m]=e,""===e&&(c.placeholder=i),(0,t.createElement)("div",{className:`${n}__value`},(0,t.createElement)(a.TextControl,s({key:l,onChange:e=>d(l,e)},c)),o.length>1&&(0,t.createElement)(a.Button,{isDestructive:!0,isSmall:!0,className:`${n}__remove-btn`,icon:"no-alt",onClick:()=>function(e){r(o.filter(((t,a)=>a!==e)))}(l)}))})):(0,t.createElement)(a.TextControl,{placeholder:i,onChange:e=>d(0,e)}),(0,t.createElement)(a.Button,{className:`${n}__insert-btn`,text:_,variant:"secondary",onClick:function(){r([...o,""])}}))};const c="wsu-gutenberg-people-directory-profile",i=(e,a)=>{const l=(0,t.useRef)(!1);(0,t.useEffect)((()=>{if(l.current){const t=e();return()=>t&&t()}l.current=!0}),a),(0,t.useEffect)((()=>()=>l.current=!1),[])},{InnerBlocks:_}=wp.blockEditor;(0,e.registerBlockType)("wsuwp/people-directory-profile",{title:"Profile",icon:"admin-users",category:"text",attributes:{hasCustomBio:{type:"boolean",default:!1}},edit:function(e){let{className:s,clientId:n,attributes:_,setAttributes:m,...d}=e;const{editPost:u}=(0,l.useDispatch)("core/editor"),[p,w]=(0,t.useState)(!1),{defaultPostTitle:h,defaultPostMeta:f}=(0,l.useSelect)((e=>{const t=e("core/editor");return{defaultPostTitle:t.getEditedPostAttribute("title"),defaultPostMeta:t.getEditedPostAttribute("meta")}})),{photoPreview:b,hasResolvedPhoto:E,isCustomPhoto:g}=(0,l.useSelect)((e=>{if(!f.wsuwp_photo)return{photoPreview:f._wsuwp_fallback_photo,hasResolvedPhoto:!0,isCustomPhoto:!1};const t=e("core").getMedia(f.wsuwp_photo);return e("core/data").hasFinishedResolution("core","getMedia",[f.wsuwp_photo])?{photoPreview:t?t.source_url:f._wsuwp_fallback_photo,hasResolvedPhoto:!0,isCustomPhoto:!!t}:{photoPreview:"",hasResolvedPhoto:!1,isCustomPhoto:!1}}),[f]),[v,N]=(0,t.useState)(h),[C,$]=(0,t.useState)({first_name:f.wsuwp_first_name,middle_name:f.wsuwp_middle_name,last_name:f.wsuwp_last_name,display_name:f.wsuwp_display_name,title:f.wsuwp_title,office:f.wsuwp_office,address:f.wsuwp_address,phone:f.wsuwp_phone,email:f.wsuwp_email,degree:f.wsuwp_degree,website:f.wsuwp_website,photo:f.wsuwp_photo});function k(e,t){$((a=>({...a,[e]:t})))}return(0,t.useEffect)((()=>{const e=setTimeout((()=>{w((()=>!1))}),3e3);return()=>clearTimeout(e)}),[p]),i((()=>{u({meta:{wsuwp_first_name:C.first_name,wsuwp_middle_name:C.middle_name,wsuwp_last_name:C.last_name,wsuwp_display_name:C.display_name,wsuwp_title:C.title,wsuwp_office:C.office,wsuwp_address:C.address,wsuwp_phone:C.phone,wsuwp_email:C.email,wsuwp_degree:C.degree,wsuwp_website:C.website,wsuwp_photo:C.photo}})}),[C]),i((()=>{const e=C.first_name||f._wsuwp_fallback_first_name,t=C.middle_name||f._wsuwp_fallback_middle_name,a=`${C.last_name||f._wsuwp_fallback_last_name}, ${e} ${t}`.trim();N(a),u({title:a})}),[C.first_name,C.middle_name,C.last_name]),(0,t.createElement)(t.Fragment,null,(0,t.createElement)("div",{className:c},(0,t.createElement)("div",{className:`${c}__header`},v&&(0,t.createElement)("h1",{className:`${c}__post-title`},v),f._wsuwp_nid&&(0,t.createElement)("div",{className:`${c}__nid`},p&&(0,t.createElement)(a.Popover,{className:`${c}__nid-copy-notice`,placement:"top-end"},"Copied!"),(0,t.createElement)(a.TextControl,{className:`${c}__nid-input`,value:f._wsuwp_nid,disabled:!0}),(0,t.createElement)(a.Button,{className:`${c}__nid-copy-btn`,label:"Copy",icon:"admin-page"}))),(0,t.createElement)("div",{className:`${c}__editor`},(0,t.createElement)("div",{className:`${c}__editor-left-column`},(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)("div",{className:`${c}__photo-field`},E&&b&&(0,t.createElement)("img",{className:`${c}__photo`,src:b})),(0,t.createElement)(o.MediaUploadCheck,null,(0,t.createElement)(o.MediaUpload,{onSelect:e=>k("photo",e.id),allowedTypes:["image"],multiple:!1,gallery:!1,value:C.photo,render:e=>{let{open:l}=e;return(0,t.createElement)(a.BaseControl,null,(0,t.createElement)(a.Button,{isPrimary:!0,onClick:l,className:`${c}__photo-upload-btn`},b?"Change Photo":"Select Photo"),g?(0,t.createElement)(a.Button,{isDestructive:!0,onClick:()=>k("photo",0),className:`${c}__photo-remove-btn`,text:"Remove Photo"}):null)}})))),(0,t.createElement)("div",{className:`${c}__editor-right-column`},(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"First Name",className:`${c}__text-control`,placeholder:f._wsuwp_fallback_first_name,onChange:e=>k("first_name",e),value:C.first_name})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Middle Name",className:`${c}__text-control`,placeholder:f._wsuwp_fallback_middle_name,onChange:e=>k("middle_name",e),value:C.middle_name})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Last Name",className:`${c}__text-control`,placeholder:f._wsuwp_fallback_last_name,onChange:e=>k("last_name",e),value:C.last_name})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Display Name",className:`${c}__text-control`,placeholder:f._wsuwp_fallback_display_name,onChange:e=>k("display_name",e),value:C.display_name})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(r,{label:"Title(s)",onChange:e=>k("title",e),insertText:"Add another title",isFallbackData:0===C.title.length,placeholder:"Enter job title",values:C.title.length?C.title:f._wsuwp_fallback_title})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Phone Number",className:`${c}__text-control`,placeholder:f._wsuwp_fallback_phone,onChange:e=>k("phone",e),value:C.phone})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Email",className:`${c}__text-control`,placeholder:f._wsuwp_fallback_email,onChange:e=>k("email",e),value:C.email})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Office",className:`${c}__text-control`,placeholder:f._wsuwp_fallback_office,onChange:e=>k("office",e),value:C.office})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Address",className:`${c}__text-control`,placeholder:f._wsuwp_fallback_address,onChange:e=>k("address",e),value:C.address})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(a.TextControl,{label:"Website",className:`${c}__text-control`,placeholder:f._wsuwp_fallback_website||"Enter website URL",onChange:e=>k("website",e),value:C.website})),(0,t.createElement)("div",{className:`${c}__edit-field`},(0,t.createElement)(r,{label:"Degree(s)",onChange:e=>k("degree",e),insertText:"Add another degree",isFallbackData:0===C.degree.length,placeholder:"Enter degree",values:C.degree.length?C.degree:f._wsuwp_fallback_degree})))),(0,t.createElement)("div",{className:`${c}__bio-container`},(0,t.createElement)("div",{className:`${c}__bio-header`},(0,t.createElement)("h2",null,"Biography"),(0,t.createElement)(a.ToggleControl,{label:"Use custom bio",className:`${c}__bio-type-toggle`,checked:_.hasCustomBio,onChange:()=>m({hasCustomBio:!_.hasCustomBio})})),_.hasCustomBio?(0,t.createElement)(o.InnerBlocks,{template:[["core/paragraph",{placeholder:"Enter biography content."}]],allowedBlocks:["core/paragraph","core/heading","core/list","core/quote","wsuwp/button","core/separator","wsuwp/row","core/image","core/gallery"],templateLock:!1}):""===f._wsuwp_fallback_bio.trim()?(0,t.createElement)("p",null,(0,t.createElement)("i",null,"No content to display.")):(0,t.createElement)("div",{dangerouslySetInnerHTML:{__html:f._wsuwp_fallback_bio}}))))},save:e=>(0,t.createElement)(_.Content,null)})}();